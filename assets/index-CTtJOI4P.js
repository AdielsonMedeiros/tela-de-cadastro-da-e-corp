(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))c(e);new MutationObserver(e=>{for(const r of e)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&c(l)}).observe(document,{childList:!0,subtree:!0});function m(e){const r={};return e.integrity&&(r.integrity=e.integrity),e.referrerPolicy&&(r.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?r.credentials="include":e.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function c(e){if(e.ep)return;e.ep=!0;const r=m(e);fetch(e.href,r)}})();const A={apiKey:"AIzaSyDPX3dljNffKYGU5fI8TRS-Qqc2ybfhDjI",authDomain:"allsafe-71650.firebaseapp.com",projectId:"allsafe-71650",storageBucket:"allsafe-71650.firebasestorage.app",messagingSenderId:"1079384435670",appId:"1:1079384435670:web:fe4f33f593bc9571b05277"};firebase.initializeApp(A);const B=firebase.firestore(),L=firebase.auth();document.addEventListener("DOMContentLoaded",()=>{const y=document.getElementById("register-form"),a=document.getElementById("email"),m=document.getElementById("name"),c=document.getElementById("lastname"),e=document.getElementById("telefone"),r=document.getElementById("endereco"),l=document.getElementById("login"),u=document.getElementById("password"),g=document.getElementById("passconfirmation"),b=document.getElementById("agreement"),v=document.getElementById("btn-submit");y.addEventListener("submit",async t=>{if(t.preventDefault(),E()){v.disabled=!0,v.innerText="Enviando...";try{const i=(await L.createUserWithEmailAndPassword(a.value.trim(),u.value.trim())).user;console.log("Usuário criado com sucesso no Auth! UID:",i.uid);const p={email:a.value.trim(),nome:m.value.trim(),sobrenome:c.value.trim(),telefone:e.value.trim(),endereco:r.value.trim(),login:l.value.trim(),timestamp:new Date};await B.collection("usuarios").doc(i.uid).set(p),console.log("Dados do perfil salvos no Firestore com o ID:",i.uid),alert("Usuário registrado com sucesso!"),y.reset()}catch(o){console.error("Erro ao registrar usuário: ",o.code,o.message),o.code==="auth/email-already-in-use"?(alert("Este endereço de e-mail já está cadastrado."),s(a,"Este e-mail já está em uso.")):o.code==="auth/weak-password"?(alert("A senha é muito fraca. Use pelo menos 6 caracteres."),s(u,"A senha deve ter no mínimo 6 caracteres.")):o.code==="auth/invalid-email"?(alert("O formato do e-mail é inválido."),s(a,"Por favor, insira um e-mail válido.")):alert("Ocorreu um erro inesperado ao realizar o cadastro.")}finally{v.disabled=!1,v.innerText="Registrar"}}else console.log("Formulário contém erros. Por favor, corrija.")});const E=()=>{const t=a.value.trim(),f=m.value.trim(),o=c.value.trim(),i=l.value.trim(),p=u.value.trim(),h=g.value.trim();let n=!0;return t===""?(s(a,"O e-mail é obrigatório."),n=!1):I(t)?d(a):(s(a,"Por favor, insira um e-mail válido."),n=!1),f===""?(s(m,"O nome é obrigatório."),n=!1):d(m),o===""?(s(c,"O sobrenome é obrigatório."),n=!1):d(c),i===""?(s(l,"O nome de usuário é obrigatório."),n=!1):d(l),p===""?(s(u,"A senha é obrigatória."),n=!1):p.length<8?(s(u,"A senha deve ter no mínimo 8 caracteres."),n=!1):d(u),h===""?(s(g,"A confirmação da senha é obrigatória."),n=!1):p!==h?(s(g,"As senhas não coincidem."),n=!1):d(g),b.checked?d(b):(s(b,"Você deve aceitar os termos de uso."),n=!1),n},s=(t,f)=>{const o=t.parentElement;let i=o.querySelector(".error-validation");i||(i=document.createElement("div"),i.className="error-validation",o.appendChild(i)),i.innerText=f,t.classList.add("error"),t.classList.remove("success")},d=t=>{const o=t.parentElement.querySelector(".error-validation");o&&o.remove(),t.classList.add("success"),t.classList.remove("error")},I=t=>/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(t).toLowerCase())});
